<div class="slide slide2-photo-capture">
  <div class="header-bar">
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left"></i>
    </button>
    <h1>Крок 1: Фото фіксація</h1>
  </div>
  <p class="subtitle">Зробіть фото автомобіля</p>

  <div class="camera-container" *ngIf="!isPhotoAnalyzed">
    <div
      class="gps-status"
      [class.active]="isGpsActive"
      [class.error]="gpsError"
    >
      <i class="fas fa-map-marker-alt"></i>
      <span>{{
        isGpsActive ? "GPS: Активно" : gpsError || "GPS: Очікування..."
      }}</span>
    </div>

    <div class="requirements-card">
      <div class="card-header">
        <i class="fas fa-camera"></i>
        <span>Спробуйте щоб у кадр потрапив:</span>
      </div>
      <ul class="requirements-list">
        <li>
          <i class="fas fa-check-circle"></i>
          <span>Автомобіль повністю</span>
        </li>
        <li>
          <i class="fas fa-check-circle"></i>
          <span>Номерний знак автомобіля</span>
        </li>
        <li>
          <i class="fas fa-check-circle"></i>
          <span>Знак паркування для інвалідів</span>
        </li>
      </ul>
    </div>
  </div>

  <button
    class="capture-button"
    (click)="openCamera()"
    [disabled]="!isGpsActive || isProcessing"
  >
    <i
      class="fas"
      [class.fa-camera]="!isProcessing"
      [class.fa-spinner]="isProcessing"
      [class.fa-spin]="isProcessing"
    ></i>
    <span>{{
      gpsError
        ? "GPS недоступний"
        : !isGpsActive
        ? "Очікування GPS..."
        : isProcessing
        ? "Обробка..."
        : isPhotoAnalyzed
        ? "Переробити фото"
        : "Зробити фото"
    }}</span>
  </button>

  <div class="analysis-error" *ngIf="captureError">
    <i class="fas fa-exclamation-circle"></i>
    <div class="error-content">
      <strong>Помилка</strong>
      <p>{{ captureError }}</p>
    </div>
  </div>

  <div class="analysis-error" *ngIf="analysisError">
    <i class="fas fa-exclamation-circle"></i>
    <div class="error-content">
      <strong>Помилка аналізу</strong>
      <p>{{ analysisError }}</p>
    </div>
  </div>

  <!-- GPS Error Alert -->
  <div class="gps-error-alert" *ngIf="gpsError && !isPhotoAnalyzed">
    <i class="fas fa-exclamation-triangle"></i>
    <div class="error-content">
      <strong>Помилка GPS</strong>
      <p>
        {{ gpsError }}. Перевірте дозволи для визначення місцеположення в
        налаштуваннях браузера.
      </p>
    </div>
  </div>

  <!-- Photo preview after capture -->
  <div class="photo-preview" *ngIf="capturedPhoto && isPhotoAnalyzed">
    <div class="preview-header">
      <i class="fas fa-check-circle"></i>
      <span>Фото успішно зроблено</span>
    </div>
    <img
      [src]="capturedPhoto.photoUrl || capturedPhoto.previewUrl"
      alt="Captured photo"
    />

    <div class="photo-time-info">
      <i class="fas fa-clock"></i>
      <div class="time-content">
        <span class="time-label">Час фіксації:</span>
        <span class="time-value">{{
          formatTime(capturedPhoto.timestamp)
        }}</span>
      </div>
    </div>

    <div class="location-info">
      <div class="location-header">
        <i class="fas fa-map-marker-alt"></i>
        <span>Координати GPS</span>
      </div>
      <div class="location-details">
        <div class="location-item">
          <span class="label">Широта:</span>
          <span class="value"
            >{{ capturedPhoto.geoLocation.latitude.toFixed(6) }}°</span
          >
        </div>
        <div class="location-item">
          <span class="label">Довгота:</span>
          <span class="value"
            >{{ capturedPhoto.geoLocation.longitude.toFixed(6) }}°</span
          >
        </div>
      </div>
    </div>

    <div class="analysis-info" *ngIf="capturedPhoto.analysis">
      <div class="analysis-header">
        <i class="fas fa-robot"></i>
        <span>Аналіз ШІ</span>
      </div>
      <div class="analysis-content">
        <div class="analysis-item">
          <span class="label">Номерний знак:</span>
          <span class="value badge">{{ capturedPhoto.analysis.plate }}</span>
        </div>
        <div class="analysis-item">
          <span class="label">Ймовірність:</span>
          <span class="value"
            >{{ capturedPhoto.analysis.confidence.toFixed(0) }}%</span
          >
        </div>
      </div>
    </div>

    <button class="continue-button sticky-action" (click)="proceedToNextStep()">
      <span>Продовжити</span>
      <i class="fas fa-arrow-right"></i>
    </button>
  </div>

  <div class="parking-signs" *ngIf="!isPhotoAnalyzed">
    <div class="sign-card">
      <img src="/assets/RSS_5_42_1.png" alt="Знак 5.42.1" class="sign-image" />
      <div class="sign-info">
        <strong>Знак 5.42.1</strong>
        <span>Загальна парковка</span>
      </div>
    </div>

    <div class="sign-card">
      <img src="/assets/RSS_7_17.png" alt="Знак 7.17" class="sign-image" />
      <div class="sign-info">
        <strong>Знак 7.17</strong>
        <span>Для інвалідів</span>
      </div>
    </div>
  </div>

  <div class="info-note" *ngIf="!isPhotoAnalyzed">
    <i class="fas fa-info-circle"></i>
    <div>
      <h4>Знак "Водій з інвалідністю"</h4>
      <p>
        Квадрат синього кольору із стороною 150 мм і білим зображенням символу
        таблички 7.17. Знак розміщується спереду і ззаду на механічних
        транспортних засобах, якими керують водії з інвалідністю або водії, які
        перевозять пасажирів з інвалідністю.
      </p>
    </div>
  </div>
</div>
